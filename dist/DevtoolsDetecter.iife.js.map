{"version":3,"file":"DevtoolsDetecter.iife.js","sources":["../index.js"],"sourcesContent":["const DevtoolsDetecter = (function () {\r\n  let isOpen = false;\r\n  let debug = false;\r\n  let benchmarkMaxN = 7000000;\r\n  let timingSamplingMaxN = 1000;\r\n  let timer = 500;\r\n  let timeOutCtl = null;\r\n  const listeners = [];\r\n  const RunListeners = () => {\r\n    for (const listener of listeners) {\r\n      try {\r\n        listener(isOpen);\r\n      } catch { }\r\n    }\r\n  }\r\n  // 屏幕打印\r\n  const Print = (msg) => {\r\n    if (debug) {\r\n      const div = document.createElement(\"div\");\r\n      div.innerHTML = `${msg}<br>`;\r\n      document.body.append(div);\r\n    }\r\n  }\r\n  // Dogs And Cats\r\n  const MyBigCat = () => {\r\n    try {\r\n      const p = [Object, Array, Set, Map, RegExp, String, \"\"];\r\n      for (const iterator of p) {\r\n        if (iterator && iterator.__proto__ && iterator.__proto__.__proto__ && iterator.__proto__.__proto__.constructor) {\r\n          if (iterator.__proto__.__proto__.constructor.name == 'Object') {\r\n            return iterator;\r\n          }\r\n        }\r\n      }\r\n      for (const iterator of Object.keys(window)) {\r\n        if (window[iterator] && window[iterator].__proto__ && window[iterator].__proto__.__proto__ && window[iterator].__proto__.__proto__.constructor) {\r\n          if (window[iterator].__proto__.__proto__.constructor.name == 'Object') {\r\n            return window[iterator];\r\n          }\r\n        }\r\n      }\r\n    } catch (error) { }\r\n  }\r\n  const MyWhiteCat = (key, child, parent) => {\r\n    MyBigCat().__proto__.__proto__[key] = child.bind(parent);\r\n  }\r\n  const MyBlackCat = (parentKey, childKey, child, parent) => {\r\n    const dog = MyBigCat().__proto__.__proto__;\r\n    if (typeof dog[parentKey] == \"undefined\") {\r\n      dog[parentKey] = {};\r\n    }\r\n    dog[parentKey][childKey] = child.bind(parent);\r\n  }\r\n  const MyWhiteDog = () => {\r\n    try {\r\n      return MathCat.random().toString(36).substring(2);\r\n    } catch (error) {\r\n      return Math.random().toString(36).substring(2);\r\n    }\r\n  }\r\n  const MyBlackDog = (key) => {\r\n    return window[key] || document[key] || MyBigCat()[key];\r\n  }\r\n  const MyRedCat = (child, parent) => {\r\n    const key = MyWhiteDog();\r\n    MyWhiteCat(key, child, parent);\r\n    return MyBlackDog(key);\r\n  }\r\n  const consoleDog = MyWhiteDog();\r\n  ['log', 'clear'].forEach(function (method) {\r\n    MyBlackCat(consoleDog, method, console[method], console);\r\n  });\r\n  const setTimeoutCat = MyRedCat(setTimeout, window);\r\n  const performanceNowCat = MyRedCat(performance.now, performance)\r\n  const Int8ArrayCat = MyRedCat(Int8Array, window);\r\n  const MathDog = MyWhiteDog();\r\n  ['pow', 'min', 'max', 'random'].forEach(function (method) {\r\n    MyBlackCat(MathDog, method, Math[method], Math);\r\n  });\r\n  const MathCat = MyBlackDog(MathDog);\r\n  const LogCat = MyBlackDog(consoleDog);\r\n\r\n  // 平均值\r\n  const Average = (arr) => {\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += arr[i];\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 方差\r\n  const Variance = (arr) => {\r\n    let avg = Average(arr);\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += MathCat.pow(arr[i] - avg, 2);\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 添加样本\r\n  const AddSample = (arr, item) => {\r\n    arr.push(item);\r\n    if (arr.length > 5) {\r\n      arr.shift();\r\n    }\r\n  }\r\n  // 基准\r\n  let Benchmark = () => {\r\n    const startTime = performanceNowCat();\r\n    const maxn = benchmarkMaxN;\r\n    const pris = new Int8ArrayCat(maxn + 1)\r\n    for (var i = 2; i <= maxn; ++i)\r\n      if (pris[i] === 0)\r\n        for (var j = i * i; j <= maxn; j += i)\r\n          pris[j] = 1;\r\n    const diff = performanceNowCat() - startTime;\r\n    return diff;\r\n  }\r\n  // 采样列表\r\n  const SampleList = [];\r\n  // 平均采样列表\r\n  const AverageSampleList = [];\r\n  // 方差采样列表\r\n  const VarianceSampleList = [];\r\n  // 标记\r\n  let FlagID = -1;\r\n  // 临界水平\r\n  const CriticalLevel = Benchmark();\r\n  // 平均临界水平\r\n  let AverageCriticalLevel = CriticalLevel;\r\n  // 方差临界水平\r\n  let VarianceCriticalLevel = CriticalLevel;\r\n  // 计时采样\r\n  const TimingSampling = () => {\r\n    FlagID++;\r\n    const startTime = performanceNowCat();\r\n    for (let check = 0; check < timingSamplingMaxN; check++) {\r\n      if (!LogCat.log) {\r\n        alert(\"Hacked!\");\r\n      }\r\n      LogCat.log(check);\r\n      LogCat.clear();\r\n    }\r\n    const diff = performanceNowCat() - startTime;\r\n    AddSample(SampleList, diff);\r\n    Print(SampleList);\r\n    if (FlagID && FlagID % 5 == 0) {\r\n      const avg = Average(SampleList);\r\n      const sd = Variance(SampleList);\r\n      AddSample(AverageSampleList, avg);\r\n      AddSample(VarianceSampleList, sd);\r\n      Print(`=== Average: ${avg} Variance: ${sd} === `);\r\n      // 平均值大于临界水平 或 采样值成接近临界水平的突增趋势\r\n      if (avg > AverageCriticalLevel || (avg > AverageCriticalLevel * 0.85 && sd > VarianceCriticalLevel && Average([SampleList[0], SampleList[1], SampleList[2]]) < Average([SampleList[1], SampleList[2], SampleList[3]]) && Average([SampleList[1], SampleList[2], SampleList[3]]) < Average([SampleList[2], SampleList[3], SampleList[4]]))) {\r\n        // 检测到 DevTools\r\n        isOpen = true;\r\n        Print(`**** !!!!!! DevTools detected !!!!! ****`);\r\n      } else {\r\n        // 没有检测到 DevTools\r\n        isOpen = false;\r\n        // 微调参数水平\r\n        if (FlagID >= 25) {\r\n          AverageCriticalLevel = Average([MathCat.min(MathCat.max(...AverageSampleList), AverageCriticalLevel), CriticalLevel]);\r\n          VarianceCriticalLevel = Average([MathCat.min(MathCat.max(...VarianceSampleList), VarianceCriticalLevel), CriticalLevel]);\r\n          Print(`=== AverageCriticalLevel: ${AverageCriticalLevel} VarianceCriticalLevel: ${VarianceCriticalLevel} ===`);\r\n        }\r\n      }\r\n    }\r\n    checkEruda();\r\n    RunListeners();\r\n    timeOutCtl = setTimeoutCat(TimingSampling, timer);\r\n  }\r\n  const checkEruda = () => {\r\n    if (isOpen)\r\n      return\r\n    if (typeof eruda !== 'undefined') {\r\n      if (eruda?._devTools?._isShow === true) {\r\n        isOpen = true;\r\n        Print(`**** !!!!!! Eruda DevTools detected !!!!! ****`);\r\n      } else {\r\n        isOpen = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  class DevtoolsDetecter {\r\n    debug() {\r\n      debug = true;\r\n      Print(`ua: ${navigator.userAgent}`)\r\n      Print(`hardwareConcurrency: ${navigator.hardwareConcurrency}`)\r\n      if (performance && performance.memory) {\r\n        Print(`memory used: ${performance.memory.usedJSHeapSize}`)\r\n        Print(`memory total: ${performance.memory.totalJSHeapSize}`)\r\n        Print(`memory limit: ${performance.memory.jsHeapSizeLimit}`)\r\n      }\r\n      Print(`Benchmark: ${CriticalLevel}`)\r\n    }\r\n    getStatus() {\r\n      return isOpen;\r\n    }\r\n    setBenchmarkMaxN(n) {\r\n      benchmarkMaxN = n;\r\n    }\r\n    setTimingSamplingMaxN(n) {\r\n      timingSamplingMaxN = n;\r\n    }\r\n    setBenchmark(callBack) {\r\n      Benchmark = callBack;\r\n    }\r\n    setTimer(t) {\r\n      timer = t;\r\n    }\r\n    addListener(callBack) {\r\n      listeners.push(callBack);\r\n    }\r\n    launch() {\r\n      return TimingSampling();\r\n    }\r\n    stop() {\r\n      clearTimeout(timeOutCtl);\r\n    }\r\n  }\r\n  return new DevtoolsDetecter();\r\n})()\r\n\r\nexport default DevtoolsDetecter;"],"names":["isOpen","debug","benchmarkMaxN","timingSamplingMaxN","timer","timeOutCtl","listeners","Print","msg","div","document","createElement","innerHTML","body","append","MyBigCat","p","Object","Array","Set","Map","RegExp","String","iterator","__proto__","constructor","name","keys","window","error","MyBlackCat","parentKey","childKey","child","parent","dog","bind","MyWhiteDog","MathCat","random","toString","substring","Math","MyBlackDog","key","MyRedCat","MyWhiteCat","consoleDog","forEach","method","console","setTimeoutCat","setTimeout","performanceNowCat","performance","now","Int8ArrayCat","Int8Array","MathDog","LogCat","Average","arr","sum","i","length","AddSample","item","push","shift","Benchmark","startTime","maxn","pris","j","SampleList","AverageSampleList","VarianceSampleList","FlagID","CriticalLevel","AverageCriticalLevel","VarianceCriticalLevel","TimingSampling","check","log","alert","clear","diff","avg","sd","pow","Variance","min","max","listener","e","checkEruda","eruda","_a","_devTools","_isShow","navigator","userAgent","hardwareConcurrency","memory","usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit","getStatus","setBenchmarkMaxN","n","setTimingSamplingMaxN","setBenchmark","callBack","setTimer","t","addListener","launch","stop","clearTimeout"],"mappings":"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"}