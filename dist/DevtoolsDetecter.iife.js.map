{"version":3,"file":"DevtoolsDetecter.iife.js","sources":["../index.js"],"sourcesContent":["const DevtoolsDetecter = (function () {\r\n  let isOpen = false;\r\n  let debug = false;\r\n  const listeners = [];\r\n  const RunListeners = () => {\r\n    for (const listener of listeners) {\r\n      try {\r\n        listener(isOpen);\r\n      } catch { }\r\n    }\r\n  }\r\n  // 屏幕打印\r\n  const Print = (msg) => {\r\n    if (debug) {\r\n      const div = document.createElement(\"div\")\r\n      div.innerHTML = `${msg}<br>`\r\n      document.body.append(div)\r\n    }\r\n  }\r\n  // Dogs And Cats\r\n  const MyBigCat = () => {\r\n    try {\r\n      const p = [Object, Array, Set, Map, RegExp, String, \"\"];\r\n      for (const iterator of p) {\r\n        if (iterator && iterator.__proto__ && iterator.__proto__.__proto__ && iterator.__proto__.__proto__.constructor) {\r\n          if (iterator.__proto__.__proto__.constructor.name == 'Object') {\r\n            return iterator;\r\n          }\r\n        }\r\n      }\r\n      for (const iterator of Object.keys(window)) {\r\n        if (window[iterator] && window[iterator].__proto__ && window[iterator].__proto__.__proto__ && window[iterator].__proto__.__proto__.constructor) {\r\n          if (window[iterator].__proto__.__proto__.constructor.name == 'Object') {\r\n            return window[iterator];\r\n          }\r\n        }\r\n      }\r\n    } catch (error) { }\r\n  }\r\n  const MyWhiteCat = (key, child, parent) => {\r\n    MyBigCat().__proto__.__proto__[key] = child.bind(parent);\r\n  }\r\n  const MyBlackCat = (parentKey, childKey, child, parent) => {\r\n    const dog = MyBigCat().__proto__.__proto__;\r\n    if (typeof dog[parentKey] == \"undefined\") {\r\n      dog[parentKey] = {};\r\n    }\r\n    dog[parentKey][childKey] = child.bind(parent);\r\n  }\r\n  const MyWhiteDog = () => {\r\n    try {\r\n      return MathCat.random().toString(36).substring(2);\r\n    } catch (error) {\r\n      return Math.random().toString(36).substring(2);\r\n    }\r\n  }\r\n  const MyBlackDog = (key) => {\r\n    return window[key] || document[key] || MyBigCat()[key];\r\n  }\r\n  const MyRedCat = (child, parent) => {\r\n    const key = MyWhiteDog();\r\n    MyWhiteCat(key, child, parent);\r\n    return MyBlackDog(key);\r\n  }\r\n  const consoleDog = MyWhiteDog();\r\n  ['log', 'clear'].forEach(function (method) {\r\n    MyBlackCat(consoleDog, method, console[method], console)\r\n  });\r\n  const setTimeoutCat = MyRedCat(setTimeout, window)\r\n  const performanceNowCat = MyRedCat(performance.now, performance)\r\n  const Int8ArrayCat = MyRedCat(Int8Array, window)\r\n  const MathDog = MyWhiteDog();\r\n  ['pow', 'min', 'max', 'random'].forEach(function (method) {\r\n    MyBlackCat(MathDog, method, Math[method], Math)\r\n  });\r\n  const MathCat = MyBlackDog(MathDog)\r\n\r\n  // 平均值\r\n  const Average = (arr) => {\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += arr[i];\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 方差\r\n  const Variance = (arr) => {\r\n    let avg = Average(arr);\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += MathCat.pow(arr[i] - avg, 2);\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 添加样本\r\n  const AddSample = (arr, item) => {\r\n    arr.push(item);\r\n    if (arr.length > 5) {\r\n      arr.shift();\r\n    }\r\n  }\r\n  // 基准\r\n  const Benchmark = () => {\r\n    const startTime = performanceNowCat();\r\n    const maxn = 7000000;\r\n    const pris = new Int8ArrayCat(maxn + 1)\r\n    for (var i = 2; i <= maxn; ++i)\r\n      if (pris[i] === 0)\r\n        for (var j = i * i; j <= maxn; j += i)\r\n          pris[j] = 1\r\n    const diff = performanceNowCat() - startTime;\r\n    return diff;\r\n  }\r\n  // 采样列表\r\n  const SampleList = [];\r\n  // 平均采样列表\r\n  const AverageSampleList = [];\r\n  // 方差采样列表\r\n  const VarianceSampleList = [];\r\n  // 标记\r\n  let FlagID = -1;\r\n  // 临界水平\r\n  const CriticalLevel = Benchmark();\r\n  // 平均临界水平\r\n  let AverageCriticalLevel = CriticalLevel;\r\n  // 方差临界水平\r\n  let VarianceCriticalLevel = CriticalLevel;\r\n  // 计时采样\r\n  const TimingSampling = () => {\r\n    FlagID++;\r\n    const consoleDogBrother = MyWhiteDog();\r\n    const LogCat = MyBlackDog(consoleDog);\r\n    ['log', 'clear'].forEach(function (method) {\r\n      MyBlackCat(consoleDogBrother, method, LogCat[method], LogCat)\r\n    });\r\n    const startTime = performanceNowCat();\r\n    for (let check = 0; check < 1000; check++) {\r\n      const LogCatBrother = MyBlackDog(consoleDogBrother)\r\n      if (!LogCatBrother.log) {\r\n        alert(\"Hacked!\");\r\n      }\r\n      LogCatBrother.log(check);\r\n      LogCatBrother.clear();\r\n    }\r\n    const diff = performanceNowCat() - startTime;\r\n    AddSample(SampleList, diff);\r\n    Print(SampleList);\r\n    if (FlagID && FlagID % 5 == 0) {\r\n      const avg = Average(SampleList);\r\n      const sd = Variance(SampleList);\r\n      AddSample(AverageSampleList, avg);\r\n      AddSample(VarianceSampleList, sd);\r\n      Print(`=== Average: ${avg} Variance: ${sd} === `);\r\n      // 平均值大于临界水平 或 采样值成接近临界水平的突增趋势\r\n      if (avg > AverageCriticalLevel || (avg > AverageCriticalLevel * 0.85 && sd > VarianceCriticalLevel && Average([SampleList[0], SampleList[1], SampleList[2]]) < Average([SampleList[1], SampleList[2], SampleList[3]]) && Average([SampleList[1], SampleList[2], SampleList[3]]) < Average([SampleList[2], SampleList[3], SampleList[4]]))) {\r\n        // 检测到 DevTools\r\n        isOpen = true;\r\n        Print(`**** !!!!!! DevTools detected !!!!! ****`);\r\n      } else {\r\n        // 没有检测到 DevTools\r\n        isOpen = false;\r\n        // 微调参数水平\r\n        if (FlagID >= 25) {\r\n          AverageCriticalLevel = Average([MathCat.min(MathCat.max(...AverageSampleList), AverageCriticalLevel), CriticalLevel]);\r\n          VarianceCriticalLevel = Average([MathCat.min(MathCat.max(...VarianceSampleList), VarianceCriticalLevel), CriticalLevel]);\r\n          Print(`=== AverageCriticalLevel: ${AverageCriticalLevel} VarianceCriticalLevel: ${VarianceCriticalLevel} ===`);\r\n        }\r\n      }\r\n    }\r\n    RunListeners();\r\n    setTimeoutCat(TimingSampling, 500);\r\n  }\r\n\r\n  class DevtoolsDetecter {\r\n    debug() {\r\n      debug = true;\r\n      Print(`ua: ${navigator.userAgent}`)\r\n      Print(`hardwareConcurrency: ${navigator.hardwareConcurrency}`)\r\n      if (performance && performance.memory) {\r\n        Print(`memory used: ${performance.memory.usedJSHeapSize}`)\r\n        Print(`memory total: ${performance.memory.totalJSHeapSize}`)\r\n        Print(`memory limit: ${performance.memory.jsHeapSizeLimit}`)\r\n      }\r\n      Print(`Benchmark: ${CriticalLevel}`)\r\n    }\r\n    getStatus() {\r\n      return isOpen;\r\n    }\r\n    addListener(callBack) {\r\n      listeners.push(callBack);\r\n    }\r\n    launch() {\r\n      return TimingSampling();\r\n    }\r\n  }\r\n  return new DevtoolsDetecter();\r\n})()\r\n\r\nexport default DevtoolsDetecter;"],"names":["isOpen","debug","listeners","Print","msg","div","document","createElement","innerHTML","body","append","MyBigCat","p","Object","Array","Set","Map","RegExp","String","iterator","__proto__","constructor","name","keys","window","error","MyBlackCat","parentKey","childKey","child","parent","dog","bind","MyWhiteDog","MathCat","random","toString","substring","Math","MyBlackDog","key","MyRedCat","MyWhiteCat","consoleDog","forEach","method","console","setTimeoutCat","setTimeout","performanceNowCat","performance","now","Int8ArrayCat","Int8Array","MathDog","Average","arr","sum","i","length","AddSample","item","push","shift","SampleList","AverageSampleList","VarianceSampleList","FlagID","CriticalLevel","startTime","maxn","pris","j","Benchmark","AverageCriticalLevel","VarianceCriticalLevel","TimingSampling","consoleDogBrother","LogCat","check","LogCatBrother","log","alert","clear","diff","avg","sd","pow","Variance","min","max","listener","e","navigator","userAgent","hardwareConcurrency","memory","usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit","getStatus","addListener","callBack","launch"],"mappings":"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"}