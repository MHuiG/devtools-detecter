{"version":3,"file":"DevtoolsDetecter.js","sources":["../index.js"],"sourcesContent":["const DevtoolsDetecter = (function () {\r\n  let isOpen = false;\r\n  let isOpenForGetterHack = false;\r\n  let debug = false;\r\n  let benchmarkMaxN = 7000000;\r\n  let timingSamplingMaxN = 1000;\r\n  let timer = 500;\r\n  let TimingSamplingCtl = null;\r\n  let GetterHackCtl = null;\r\n\r\n  const Status = () => {\r\n    return isOpen || isOpenForGetterHack;\r\n  }\r\n  const listeners = [];\r\n  const RunListeners = () => {\r\n    for (const listener of listeners) {\r\n      try {\r\n        listener(Status());\r\n      } catch { }\r\n    }\r\n  }\r\n  // 屏幕打印\r\n  const Print = (msg) => {\r\n    if (debug) {\r\n      const div = document.createElement(\"div\");\r\n      div.innerHTML = `${msg}<br>`;\r\n      document.body.append(div);\r\n    }\r\n  }\r\n  // Dogs And Cats\r\n  const MyBigCat = () => {\r\n    try {\r\n      const p = [Object, Array, Set, Map, RegExp, String, \"\"];\r\n      for (const iterator of p) {\r\n        if (iterator && iterator.__proto__ && iterator.__proto__.__proto__ && iterator.__proto__.__proto__.constructor) {\r\n          if (iterator.__proto__.__proto__.constructor.name == 'Object') {\r\n            return iterator;\r\n          }\r\n        }\r\n      }\r\n      for (const iterator of Object.keys(window)) {\r\n        if (window[iterator] && window[iterator].__proto__ && window[iterator].__proto__.__proto__ && window[iterator].__proto__.__proto__.constructor) {\r\n          if (window[iterator].__proto__.__proto__.constructor.name == 'Object') {\r\n            return window[iterator];\r\n          }\r\n        }\r\n      }\r\n    } catch (error) { }\r\n  }\r\n  const MyWhiteCat = (key, child, parent) => {\r\n    MyBigCat().__proto__.__proto__[key] = child.bind(parent);\r\n  }\r\n  const MyBlackCat = (parentKey, childKey, child, parent) => {\r\n    const dog = MyBigCat().__proto__.__proto__;\r\n    if (typeof dog[parentKey] == \"undefined\") {\r\n      dog[parentKey] = {};\r\n    }\r\n    dog[parentKey][childKey] = child.bind(parent);\r\n  }\r\n  const MyWhiteDog = () => {\r\n    try {\r\n      return MathCat.random().toString(36).substring(2);\r\n    } catch (error) {\r\n      return Math.random().toString(36).substring(2);\r\n    }\r\n  }\r\n  const MyBlackDog = (key) => {\r\n    return window[key] || document[key] || MyBigCat()[key];\r\n  }\r\n  const MyRedCat = (child, parent) => {\r\n    const key = MyWhiteDog();\r\n    MyWhiteCat(key, child, parent);\r\n    return MyBlackDog(key);\r\n  }\r\n  const consoleDog = MyWhiteDog();\r\n  ['log', 'clear'].forEach(function (method) {\r\n    MyBlackCat(consoleDog, method, console[method], console);\r\n  });\r\n  const setIntervalCat = MyRedCat(setInterval, window);\r\n  const performanceNowCat = MyRedCat(performance.now, performance)\r\n  const Int8ArrayCat = MyRedCat(Int8Array, window);\r\n  const MathDog = MyWhiteDog();\r\n  ['pow', 'min', 'max', 'random'].forEach(function (method) {\r\n    MyBlackCat(MathDog, method, Math[method], Math);\r\n  });\r\n  const MathCat = MyBlackDog(MathDog);\r\n  const LogCat = MyBlackDog(consoleDog);\r\n  const log = console\r\n\r\n  // getter hack check for IECoreEdge\r\n  const div = document.createElement('div');\r\n  Object.defineProperty(div, \"id\", {\r\n    get: () => {\r\n      isOpenForGetterHack = true;\r\n      Print(`**** !!!!!! [Getter Hack] DevTools detected !!!!! ****`);\r\n      RunListeners();\r\n    }\r\n  });\r\n  const GetterHack = () => {\r\n    isOpenForGetterHack = false;\r\n    log.log(div);\r\n    log.clear(div);\r\n  }\r\n\r\n  // 平均值\r\n  const Average = (arr) => {\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += arr[i];\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 方差\r\n  const Variance = (arr) => {\r\n    let avg = Average(arr);\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += MathCat.pow(arr[i] - avg, 2);\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 添加样本\r\n  const AddSample = (arr, item) => {\r\n    arr.push(item);\r\n    if (arr.length > 5) {\r\n      arr.shift();\r\n    }\r\n  }\r\n  // 基准\r\n  let Benchmark = () => {\r\n    const startTime = performanceNowCat();\r\n    const maxn = benchmarkMaxN;\r\n    const pris = new Int8ArrayCat(maxn + 1)\r\n    for (var i = 2; i <= maxn; ++i)\r\n      if (pris[i] === 0)\r\n        for (var j = i * i; j <= maxn; j += i)\r\n          pris[j] = 1;\r\n    const diff = performanceNowCat() - startTime;\r\n    return diff;\r\n  }\r\n  // 采样列表\r\n  const SampleList = [];\r\n  // 平均采样列表\r\n  const AverageSampleList = [];\r\n  // 方差采样列表\r\n  const VarianceSampleList = [];\r\n  // 标记\r\n  let FlagID = -1;\r\n  // 临界水平\r\n  const CriticalLevel = Benchmark();\r\n  // 平均临界水平\r\n  let AverageCriticalLevel = CriticalLevel;\r\n  // 方差临界水平\r\n  let VarianceCriticalLevel = CriticalLevel;\r\n  // 计时采样\r\n  const TimingSampling = () => {\r\n    FlagID++;\r\n    const startTime = performanceNowCat();\r\n    for (let check = 0; check < timingSamplingMaxN; check++) {\r\n      if (!LogCat.log) {\r\n        alert(\"Hacked!\");\r\n      }\r\n      LogCat.log(check);\r\n      LogCat.clear();\r\n    }\r\n    const diff = performanceNowCat() - startTime;\r\n    AddSample(SampleList, diff);\r\n    Print(SampleList);\r\n    if (FlagID && FlagID % 5 == 0) {\r\n      const avg = Average(SampleList);\r\n      const sd = Variance(SampleList);\r\n      AddSample(AverageSampleList, avg);\r\n      AddSample(VarianceSampleList, sd);\r\n      Print(`=== Average: ${avg} Variance: ${sd} === `);\r\n      // 平均值大于临界水平 或 采样值成接近临界水平的突增趋势\r\n      if (avg > AverageCriticalLevel || (avg > AverageCriticalLevel * 0.85 && sd > VarianceCriticalLevel && Average([SampleList[0], SampleList[1], SampleList[2]]) < Average([SampleList[1], SampleList[2], SampleList[3]]) && Average([SampleList[1], SampleList[2], SampleList[3]]) < Average([SampleList[2], SampleList[3], SampleList[4]]))) {\r\n        // 检测到 DevTools\r\n        isOpen = true;\r\n        Print(`**** !!!!!! DevTools detected !!!!! ****`);\r\n      } else {\r\n        // 没有检测到 DevTools\r\n        isOpen = false;\r\n        // 微调参数水平\r\n        if (FlagID >= 25) {\r\n          AverageCriticalLevel = Average([MathCat.min(MathCat.max(...AverageSampleList), AverageCriticalLevel), CriticalLevel]);\r\n          VarianceCriticalLevel = Average([MathCat.min(MathCat.max(...VarianceSampleList), VarianceCriticalLevel), CriticalLevel]);\r\n          Print(`=== AverageCriticalLevel: ${AverageCriticalLevel} VarianceCriticalLevel: ${VarianceCriticalLevel} ===`);\r\n        }\r\n      }\r\n    }\r\n    checkEruda();\r\n    RunListeners();\r\n  }\r\n  const checkEruda = () => {\r\n    if (isOpen)\r\n      return\r\n    if (typeof eruda !== 'undefined') {\r\n      if (eruda?._devTools?._isShow === true) {\r\n        isOpen = true;\r\n        Print(`**** !!!!!! [Eruda] DevTools detected !!!!! ****`);\r\n      } else {\r\n        isOpen = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  class DevtoolsDetecter {\r\n    debug() {\r\n      debug = true;\r\n      Print(`ua: ${navigator.userAgent}`)\r\n      Print(`hardwareConcurrency: ${navigator.hardwareConcurrency}`)\r\n      if (performance && performance.memory) {\r\n        Print(`memory used: ${performance.memory.usedJSHeapSize}`)\r\n        Print(`memory total: ${performance.memory.totalJSHeapSize}`)\r\n        Print(`memory limit: ${performance.memory.jsHeapSizeLimit}`)\r\n      }\r\n      Print(`Benchmark: ${CriticalLevel}`)\r\n    }\r\n    getStatus() {\r\n      return Status();\r\n    }\r\n    setBenchmarkMaxN(n) {\r\n      benchmarkMaxN = n;\r\n    }\r\n    setTimingSamplingMaxN(n) {\r\n      timingSamplingMaxN = n;\r\n    }\r\n    setBenchmark(callBack) {\r\n      Benchmark = callBack;\r\n    }\r\n    setTimer(t) {\r\n      timer = t;\r\n    }\r\n    addListener(callBack) {\r\n      listeners.push(callBack);\r\n    }\r\n    launch() {\r\n      TimingSamplingCtl = setIntervalCat(TimingSampling, timer);\r\n      GetterHackCtl = setIntervalCat(GetterHack, timer);\r\n    }\r\n    stop() {\r\n      clearInterval(TimingSamplingCtl);\r\n      clearInterval(GetterHackCtl);\r\n    }\r\n  }\r\n  return new DevtoolsDetecter();\r\n})()\r\n\r\nexport default DevtoolsDetecter;"],"names":["isOpen","isOpenForGetterHack","debug","benchmarkMaxN","timingSamplingMaxN","timer","TimingSamplingCtl","GetterHackCtl","Status","listeners","RunListeners","listener","e","Print","msg","div2","document","createElement","innerHTML","body","append","MyBigCat","p","Object","Array","Set","Map","RegExp","String","iterator","__proto__","constructor","name","keys","window","error","MyBlackCat","parentKey","childKey","child","parent","dog","bind","MyWhiteDog","MathCat","random","toString","substring","Math","MyBlackDog","key","MyRedCat","MyWhiteCat","consoleDog","forEach","method","console","setIntervalCat","setInterval","performanceNowCat","performance","now","Int8ArrayCat","Int8Array","MathDog","LogCat","log","div","defineProperty","get","GetterHack","clear","Average","arr","sum","i","length","AddSample","item","push","shift","Benchmark","startTime","maxn","pris","j","SampleList","AverageSampleList","VarianceSampleList","FlagID","CriticalLevel","AverageCriticalLevel","VarianceCriticalLevel","TimingSampling","check","alert","diff","avg","sd","pow","Variance","min","max","checkEruda","eruda","_a","_devTools","_isShow","navigator","userAgent","hardwareConcurrency","memory","usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit","getStatus","setBenchmarkMaxN","n","setTimingSamplingMaxN","setBenchmark","callBack","setTimer","t","addListener","launch","stop","clearInterval"],"mappings":"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"}