{"version":3,"file":"DevtoolsDetecter.es.js","sources":["../index.js"],"sourcesContent":["const DevtoolsDetecter = (function () {\r\n  let isOpen = false;\r\n  let debug = false;\r\n  let benchmarkMaxN = 7000000;\r\n  let timingSamplingMaxN = 1000;\r\n  let timer = 500;\r\n  let timeOutCtl = null;\r\n  const listeners = [];\r\n  const RunListeners = () => {\r\n    for (const listener of listeners) {\r\n      try {\r\n        listener(isOpen);\r\n      } catch { }\r\n    }\r\n  }\r\n  // 屏幕打印\r\n  const Print = (msg) => {\r\n    if (debug) {\r\n      const div = document.createElement(\"div\");\r\n      div.innerHTML = `${msg}<br>`;\r\n      document.body.append(div);\r\n    }\r\n  }\r\n  // Dogs And Cats\r\n  const MyBigCat = () => {\r\n    try {\r\n      const p = [Object, Array, Set, Map, RegExp, String, \"\"];\r\n      for (const iterator of p) {\r\n        if (iterator && iterator.__proto__ && iterator.__proto__.__proto__ && iterator.__proto__.__proto__.constructor) {\r\n          if (iterator.__proto__.__proto__.constructor.name == 'Object') {\r\n            return iterator;\r\n          }\r\n        }\r\n      }\r\n      for (const iterator of Object.keys(window)) {\r\n        if (window[iterator] && window[iterator].__proto__ && window[iterator].__proto__.__proto__ && window[iterator].__proto__.__proto__.constructor) {\r\n          if (window[iterator].__proto__.__proto__.constructor.name == 'Object') {\r\n            return window[iterator];\r\n          }\r\n        }\r\n      }\r\n    } catch (error) { }\r\n  }\r\n  const MyWhiteCat = (key, child, parent) => {\r\n    MyBigCat().__proto__.__proto__[key] = child.bind(parent);\r\n  }\r\n  const MyBlackCat = (parentKey, childKey, child, parent) => {\r\n    const dog = MyBigCat().__proto__.__proto__;\r\n    if (typeof dog[parentKey] == \"undefined\") {\r\n      dog[parentKey] = {};\r\n    }\r\n    dog[parentKey][childKey] = child.bind(parent);\r\n  }\r\n  const MyWhiteDog = () => {\r\n    try {\r\n      return MathCat.random().toString(36).substring(2);\r\n    } catch (error) {\r\n      return Math.random().toString(36).substring(2);\r\n    }\r\n  }\r\n  const MyBlackDog = (key) => {\r\n    return window[key] || document[key] || MyBigCat()[key];\r\n  }\r\n  const MyRedCat = (child, parent) => {\r\n    const key = MyWhiteDog();\r\n    MyWhiteCat(key, child, parent);\r\n    return MyBlackDog(key);\r\n  }\r\n  const consoleDog = MyWhiteDog();\r\n  ['log', 'clear'].forEach(function (method) {\r\n    MyBlackCat(consoleDog, method, console[method], console);\r\n  });\r\n  const setTimeoutCat = MyRedCat(setTimeout, window);\r\n  const performanceNowCat = MyRedCat(performance.now, performance)\r\n  const Int8ArrayCat = MyRedCat(Int8Array, window);\r\n  const MathDog = MyWhiteDog();\r\n  ['pow', 'min', 'max', 'random'].forEach(function (method) {\r\n    MyBlackCat(MathDog, method, Math[method], Math);\r\n  });\r\n  const MathCat = MyBlackDog(MathDog);\r\n  const LogCat = MyBlackDog(consoleDog);\r\n\r\n  // 平均值\r\n  const Average = (arr) => {\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += arr[i];\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 方差\r\n  const Variance = (arr) => {\r\n    let avg = Average(arr);\r\n    let sum = 0;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      sum += MathCat.pow(arr[i] - avg, 2);\r\n    }\r\n    return sum / arr.length;\r\n  }\r\n  // 添加样本\r\n  const AddSample = (arr, item) => {\r\n    arr.push(item);\r\n    if (arr.length > 5) {\r\n      arr.shift();\r\n    }\r\n  }\r\n  // 基准\r\n  let Benchmark = () => {\r\n    const startTime = performanceNowCat();\r\n    const maxn = benchmarkMaxN;\r\n    const pris = new Int8ArrayCat(maxn + 1)\r\n    for (var i = 2; i <= maxn; ++i)\r\n      if (pris[i] === 0)\r\n        for (var j = i * i; j <= maxn; j += i)\r\n          pris[j] = 1;\r\n    const diff = performanceNowCat() - startTime;\r\n    return diff;\r\n  }\r\n  // 采样列表\r\n  const SampleList = [];\r\n  // 平均采样列表\r\n  const AverageSampleList = [];\r\n  // 方差采样列表\r\n  const VarianceSampleList = [];\r\n  // 标记\r\n  let FlagID = -1;\r\n  // 临界水平\r\n  const CriticalLevel = Benchmark();\r\n  // 平均临界水平\r\n  let AverageCriticalLevel = CriticalLevel;\r\n  // 方差临界水平\r\n  let VarianceCriticalLevel = CriticalLevel;\r\n  // 计时采样\r\n  const TimingSampling = () => {\r\n    FlagID++;\r\n    const startTime = performanceNowCat();\r\n    for (let check = 0; check < timingSamplingMaxN; check++) {\r\n      if (!LogCat.log) {\r\n        alert(\"Hacked!\");\r\n      }\r\n      LogCat.log(check);\r\n      LogCat.clear();\r\n    }\r\n    const diff = performanceNowCat() - startTime;\r\n    AddSample(SampleList, diff);\r\n    Print(SampleList);\r\n    if (FlagID && FlagID % 5 == 0) {\r\n      const avg = Average(SampleList);\r\n      const sd = Variance(SampleList);\r\n      AddSample(AverageSampleList, avg);\r\n      AddSample(VarianceSampleList, sd);\r\n      Print(`=== Average: ${avg} Variance: ${sd} === `);\r\n      // 平均值大于临界水平 或 采样值成接近临界水平的突增趋势\r\n      if (avg > AverageCriticalLevel || (avg > AverageCriticalLevel * 0.85 && sd > VarianceCriticalLevel && Average([SampleList[0], SampleList[1], SampleList[2]]) < Average([SampleList[1], SampleList[2], SampleList[3]]) && Average([SampleList[1], SampleList[2], SampleList[3]]) < Average([SampleList[2], SampleList[3], SampleList[4]]))) {\r\n        // 检测到 DevTools\r\n        isOpen = true;\r\n        Print(`**** !!!!!! DevTools detected !!!!! ****`);\r\n      } else {\r\n        // 没有检测到 DevTools\r\n        isOpen = false;\r\n        // 微调参数水平\r\n        if (FlagID >= 25) {\r\n          AverageCriticalLevel = Average([MathCat.min(MathCat.max(...AverageSampleList), AverageCriticalLevel), CriticalLevel]);\r\n          VarianceCriticalLevel = Average([MathCat.min(MathCat.max(...VarianceSampleList), VarianceCriticalLevel), CriticalLevel]);\r\n          Print(`=== AverageCriticalLevel: ${AverageCriticalLevel} VarianceCriticalLevel: ${VarianceCriticalLevel} ===`);\r\n        }\r\n      }\r\n    }\r\n    RunListeners();\r\n    timeOutCtl = setTimeoutCat(TimingSampling, timer);\r\n  }\r\n\r\n  class DevtoolsDetecter {\r\n    debug() {\r\n      debug = true;\r\n      Print(`ua: ${navigator.userAgent}`)\r\n      Print(`hardwareConcurrency: ${navigator.hardwareConcurrency}`)\r\n      if (performance && performance.memory) {\r\n        Print(`memory used: ${performance.memory.usedJSHeapSize}`)\r\n        Print(`memory total: ${performance.memory.totalJSHeapSize}`)\r\n        Print(`memory limit: ${performance.memory.jsHeapSizeLimit}`)\r\n      }\r\n      Print(`Benchmark: ${CriticalLevel}`)\r\n    }\r\n    getStatus() {\r\n      return isOpen;\r\n    }\r\n    setBenchmarkMaxN(n) {\r\n      benchmarkMaxN = n;\r\n    }\r\n    setTimingSamplingMaxN(n) {\r\n      timingSamplingMaxN = n;\r\n    }\r\n    setBenchmark(callBack) {\r\n      Benchmark = callBack;\r\n    }\r\n    setTimer(t) {\r\n      timer = t;\r\n    }\r\n    addListener(callBack) {\r\n      listeners.push(callBack);\r\n    }\r\n    launch() {\r\n      return TimingSampling();\r\n    }\r\n    stop() {\r\n      clearTimeout(timeOutCtl);\r\n    }\r\n  }\r\n  return new DevtoolsDetecter();\r\n})()\r\n\r\nexport default DevtoolsDetecter;"],"names":[],"mappings":"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"}